#!/usr/bin/env python3

"""
Compute state space kinematic matrices for xArm7 robot arm (5 links, 7 joints)
"""

import numpy as np


class xArm7_kinematics():
    def __init__(self):

        self.l1 = 0.267
        self.l2 = 0.293
        self.l3 = 0.0525
        self.l4 = 0.3512
        self.l5 = 0.1232

        self.theta1 = 0.2225  # (rad) (=12.75deg)
        self.theta2 = 0.6646  # (rad) (=38.08deg)

        pass

    def compute_jacobian(self, r_joints_array):    

    #we compute the jacobian matrix using the partial deratives of the px,py,pz of the end-effector for every q

        q1 = r_joints_array[0]
        q2 = r_joints_array[1]
        q3 = r_joints_array[2]
        q4 = r_joints_array[3]
        q5 = r_joints_array[4]
        q6 = r_joints_array[5]
        q7 = r_joints_array[6]

        J_11 = -self.l2*np.sin(q1)*np.sin(q2) - self.l3*np.sin(q1)*np.cos(q2)*np.cos(q3) - self.l3*np.sin(q3)*np.cos(q1) + self.l4*np.sin(q1)*np.sin(q2)*np.cos(q4 + self.theta1) - self.l4*np.sin(q1)*np.sin(q4 + self.theta1)*np.cos(q2)*np.cos(q3) - self.l4*np.sin(q3)*np.sin(q4 + self.theta1)*np.cos(q1) + self.l5*np.sin(q1)*np.sin(q2)*np.sin(q4)*np.sin(q6 - self.theta2)*np.cos(q5) + self.l5*np.sin(q1)*np.sin(q2)*np.cos(q4)*np.cos(q6 - self.theta2) + self.l5*np.sin(q1)*np.sin(q3)*np.sin(q5)*np.sin(q6 - self.theta2)*np.cos(q2) - self.l5*np.sin(q1)*np.sin(q4)*np.cos(q2)*np.cos(q3)*np.cos(q6 - self.theta2) + self.l5*np.sin(q1)*np.sin(q6 - self.theta2)*np.cos(q2)*np.cos(q3)*np.cos(q4)*np.cos(q5) - self.l5*np.sin(q3)*np.sin(q4)*np.cos(q1)*np.cos(q6 - self.theta2) + self.l5*np.sin(q3)*np.sin(q6 - self.theta2)*np.cos(q1)*np.cos(q4)*np.cos(q5) - self.l5*np.sin(q5)*np.sin(q6 - self.theta2)*np.cos(q1)*np.cos(q3)

        J_12 = self.l2*np.cos(q1)*np.cos(q2) - self.l3*np.sin(q2)*np.cos(q1)*np.cos(q3) - self.l4*np.sin(q2)*np.sin(q4 + self.theta1)*np.cos(q1)*np.cos(q3) - self.l4*np.cos(q1)*np.cos(q2)*np.cos(q4 + self.theta1) + self.l5*np.sin(q2)*np.sin(q3)*np.sin(q5)*np.sin(q6 - self.theta2)*np.cos(q1) - self.l5*np.sin(q2)*np.sin(q4)*np.cos(q1)*np.cos(q3)*np.cos(q6 - self.theta2) + self.l5*np.sin(q2)*np.sin(q6 - self.theta2)*np.cos(q1)*np.cos(q3)*np.cos(q4)*np.cos(q5) - self.l5*np.sin(q4)*np.sin(q6 - self.theta2)*np.cos(q1)*np.cos(q2)*np.cos(q5) - self.l5*np.cos(q1)*np.cos(q2)*np.cos(q4)*np.cos(q6 - self.theta2)

        J_13 = -self.l3*np.sin(q1)*np.cos(q3) - self.l3*np.sin(q3)*np.cos(q1)*np.cos(q2) - self.l4*np.sin(q1)*np.sin(q4 + self.theta1)*np.cos(q3) - self.l4*np.sin(q3)*np.sin(q4 + self.theta1)*np.cos(q1)*np.cos(q2) + self.l5*np.sin(q1)*np.sin(q3)*np.sin(q5)*np.sin(q6 - self.theta2) - self.l5*np.sin(q1)*np.sin(q4)*np.cos(q3)*np.cos(q6 - self.theta2) + self.l5*np.sin(q1)*np.sin(q6 - self.theta2)*np.cos(q3)*np.cos(q4)*np.cos(q5) - self.l5*np.sin(q3)*np.sin(q4)*np.cos(q1)*np.cos(q2)*np.cos(q6 - self.theta2) + self.l5*np.sin(q3)*np.sin(q6 - self.theta2)*np.cos(q1)*np.cos(q2)*np.cos(q4)*np.cos(q5) - self.l5*np.sin(q5)*np.sin(q6 - self.theta2)*np.cos(q1)*np.cos(q2)*np.cos(q3)

        J_14 = -self.l4*np.sin(q1)*np.sin(q3)*np.cos(q4 + self.theta1) + self.l4*np.sin(q2)*np.sin(q4 + self.theta1)*np.cos(q1) + self.l4*np.cos(q1)*np.cos(q2)*np.cos(q3)*np.cos(q4 + self.theta1) - self.l5*np.sin(q1)*np.sin(q3)*np.sin(q4)*np.sin(q6 - self.theta2)*np.cos(q5) - self.l5*np.sin(q1)*np.sin(q3)*np.cos(q4)*np.cos(q6 - self.theta2) + self.l5*np.sin(q2)*np.sin(q4)*np.cos(q1)*np.cos(q6 - self.theta2) - self.l5*np.sin(q2)*np.sin(q6 - self.theta2)*np.cos(q1)*np.cos(q4)*np.cos(q5) + self.l5*np.sin(q4)*np.sin(q6 - self.theta2)*np.cos(q1)*np.cos(q2)*np.cos(q3)*np.cos(q5) + self.l5*np.cos(q1)*np.cos(q2)*np.cos(q3)*np.cos(q4)*np.cos(q6 - self.theta2)

        J_15 = -self.l5*np.sin(q1)*np.sin(q3)*np.sin(q5)*np.sin(q6 - self.theta2)*np.cos(q4) - self.l5*np.sin(q1)*np.sin(q6 - self.theta2)*np.cos(q3)*np.cos(q5) + self.l5*np.sin(q2)*np.sin(q4)*np.sin(q5)*np.sin(q6 - self.theta2)*np.cos(q1) - self.l5*np.sin(q3)*np.sin(q6 - self.theta2)*np.cos(q1)*np.cos(q2)*np.cos(q5) + self.l5*np.sin(q5)*np.sin(q6 - self.theta2)*np.cos(q1)*np.cos(q2)*np.cos(q3)*np.cos(q4)

        J_16 = self.l5*np.sin(q1)*np.sin(q3)*np.sin(q4)*np.sin(q6 - self.theta2) + self.l5*np.sin(q1)*np.sin(q3)*np.cos(q4)*np.cos(q5)*np.cos(q6 - self.theta2) - self.l5*np.sin(q1)*np.sin(q5)*np.cos(q3)*np.cos(q6 - self.theta2) - self.l5*np.sin(q2)*np.sin(q4)*np.cos(q1)*np.cos(q5)*np.cos(q6 - self.theta2) + self.l5*np.sin(q2)*np.sin(q6 - self.theta2)*np.cos(q1)*np.cos(q4) - self.l5*np.sin(q3)*np.sin(q5)*np.cos(q1)*np.cos(q2)*np.cos(q6 - self.theta2) - self.l5*np.sin(q4)*np.sin(q6 - self.theta2)*np.cos(q1)*np.cos(q2)*np.cos(q3) - self.l5*np.cos(q1)*np.cos(q2)*np.cos(q3)*np.cos(q4)*np.cos(q5)*np.cos(q6 - self.theta2)

        J_17 = 0

        J_21 = self.l2*np.sin(q2)*np.cos(q1) - self.l3*np.sin(q1)*np.sin(q3) + self.l3*np.cos(q1)*np.cos(q2)*np.cos(q3) - self.l4*np.sin(q1)*np.sin(q3)*np.sin(q4 + self.theta1) - self.l4*np.sin(q2)*np.cos(q1)*np.cos(q4 + self.theta1) + self.l4*np.sin(q4 + self.theta1)*np.cos(q1)*np.cos(q2)*np.cos(q3) - self.l5*np.sin(q1)*np.sin(q3)*np.sin(q4)*np.cos(q6 - self.theta2) + self.l5*np.sin(q1)*np.sin(q3)*np.sin(q6 - self.theta2)*np.cos(q4)*np.cos(q5) - self.l5*np.sin(q1)*np.sin(q5)*np.sin(q6 - self.theta2)*np.cos(q3) - self.l5*np.sin(q2)*np.sin(q4)*np.sin(q6 - self.theta2)*np.cos(q1)*np.cos(q5) - self.l5*np.sin(q2)*np.cos(q1)*np.cos(q4)*np.cos(q6 - self.theta2) - self.l5*np.sin(q3)*np.sin(q5)*np.sin(q6 - self.theta2)*np.cos(q1)*np.cos(q2) + self.l5*np.sin(q4)*np.cos(q1)*np.cos(q2)*np.cos(q3)*np.cos(q6 - self.theta2) - self.l5*np.sin(q6 - self.theta2)*np.cos(q1)*np.cos(q2)*np.cos(q3)*np.cos(q4)*np.cos(q5)

        J_22 = self.l2*np.sin(q1)*np.cos(q2) - self.l3*np.sin(q1)*np.sin(q2)*np.cos(q3) - self.l4*np.sin(q1)*np.sin(q2)*np.sin(q4 + self.theta1)*np.cos(q3) - self.l4*np.sin(q1)*np.cos(q2)*np.cos(q4 + self.theta1) + self.l5*np.sin(q1)*np.sin(q2)*np.sin(q3)*np.sin(q5)*np.sin(q6 - self.theta2) - self.l5*np.sin(q1)*np.sin(q2)*np.sin(q4)*np.cos(q3)*np.cos(q6 - self.theta2) + self.l5*np.sin(q1)*np.sin(q2)*np.sin(q6 - self.theta2)*np.cos(q3)*np.cos(q4)*np.cos(q5) - self.l5*np.sin(q1)*np.sin(q4)*np.sin(q6 - self.theta2)*np.cos(q2)*np.cos(q5) - self.l5*np.sin(q1)*np.cos(q2)*np.cos(q4)*np.cos(q6 - self.theta2)

        J_23 = -self.l3*np.sin(q1)*np.sin(q3)*np.cos(q2) + self.l3*np.cos(q1)*np.cos(q3) - self.l4*np.sin(q1)*np.sin(q3)*np.sin(q4 + self.theta1)*np.cos(q2) + self.l4*np.sin(q4 + self.theta1)*np.cos(q1)*np.cos(q3) - self.l5*np.sin(q1)*np.sin(q3)*np.sin(q4)*np.cos(q2)*np.cos(q6 - self.theta2) + self.l5*np.sin(q1)*np.sin(q3)*np.sin(q6 - self.theta2)*np.cos(q2)*np.cos(q4)*np.cos(q5) - self.l5*np.sin(q1)*np.sin(q5)*np.sin(q6 - self.theta2)*np.cos(q2)*np.cos(q3) - self.l5*np.sin(q3)*np.sin(q5)*np.sin(q6 - self.theta2)*np.cos(q1) + self.l5*np.sin(q4)*np.cos(q1)*np.cos(q3)*np.cos(q6 - self.theta2) - self.l5*np.sin(q6 - self.theta2)*np.cos(q1)*np.cos(q3)*np.cos(q4)*np.cos(q5)

        J_24 = self.l4*np.sin(q1)*np.sin(q2)*np.sin(q4 + self.theta1) + self.l4*np.sin(q1)*np.cos(q2)*np.cos(q3)*np.cos(q4 + self.theta1) + self.l4*np.sin(q3)*np.cos(q1)*np.cos(q4 + self.theta1) + self.l5*np.sin(q1)*np.sin(q2)*np.sin(q4)*np.cos(q6 - self.theta2) - self.l5*np.sin(q1)*np.sin(q2)*np.sin(q6 - self.theta2)*np.cos(q4)*np.cos(q5) + self.l5*np.sin(q1)*np.sin(q4)*np.sin(q6 - self.theta2)*np.cos(q2)*np.cos(q3)*np.cos(q5) + self.l5*np.sin(q1)*np.cos(q2)*np.cos(q3)*np.cos(q4)*np.cos(q6 - self.theta2) + self.l5*np.sin(q3)*np.sin(q4)*np.sin(q6 - self.theta2)*np.cos(q1)*np.cos(q5) + self.l5*np.sin(q3)*np.cos(q1)*np.cos(q4)*np.cos(q6 - self.theta2)

        J_25 = self.l5*np.sin(q1)*np.sin(q2)*np.sin(q4)*np.sin(q5)*np.sin(q6 - self.theta2) - self.l5*np.sin(q1)*np.sin(q3)*np.sin(q6 - self.theta2)*np.cos(q2)*np.cos(q5) + self.l5*np.sin(q1)*np.sin(q5)*np.sin(q6 - self.theta2)*np.cos(q2)*np.cos(q3)*np.cos(q4) + self.l5*np.sin(q3)*np.sin(q5)*np.sin(q6 - self.theta2)*np.cos(q1)*np.cos(q4) + self.l5*np.sin(q6 - self.theta2)*np.cos(q1)*np.cos(q3)*np.cos(q5)

        J_26 = -self.l5*np.sin(q1)*np.sin(q2)*np.sin(q4)*np.cos(q5)*np.cos(q6 - self.theta2) + self.l5*np.sin(q1)*np.sin(q2)*np.sin(q6 - self.theta2)*np.cos(q4) - self.l5*np.sin(q1)*np.sin(q3)*np.sin(q5)*np.cos(q2)*np.cos(q6 - self.theta2) - self.l5*np.sin(q1)*np.sin(q4)*np.sin(q6 - self.theta2)*np.cos(q2)*np.cos(q3) - self.l5*np.sin(q1)*np.cos(q2)*np.cos(q3)*np.cos(q4)*np.cos(q5)*np.cos(q6 - self.theta2) - self.l5*np.sin(q3)*np.sin(q4)*np.sin(q6 - self.theta2)*np.cos(q1) - self.l5*np.sin(q3)*np.cos(q1)*np.cos(q4)*np.cos(q5)*np.cos(q6 - self.theta2) + self.l5*np.sin(q5)*np.cos(q1)*np.cos(q3)*np.cos(q6 - self.theta2)

        J_27 = 0

        J_31 = 0

        J_32 = -self.l2*np.sin(q2) - self.l3*np.cos(q2)*np.cos(q3) + self.l4*np.sin(q2)*np.cos(q4 + self.theta1) - self.l4*np.sin(q4 + self.theta1)*np.cos(q2)*np.cos(q3) + self.l5*np.sin(q2)*np.sin(q4)*np.sin(q6 - self.theta2)*np.cos(q5) + self.l5*np.sin(q2)*np.cos(q4)*np.cos(q6 - self.theta2) + self.l5*np.sin(q3)*np.sin(q5)*np.sin(q6 - self.theta2)*np.cos(q2) - self.l5*np.sin(q4)*np.cos(q2)*np.cos(q3)*np.cos(q6 - self.theta2) + self.l5*np.sin(q6 - self.theta2)*np.cos(q2)*np.cos(q3)*np.cos(q4)*np.cos(q5)

        J_33 = self.l3*np.sin(q2)*np.sin(q3) + self.l4*np.sin(q2)*np.sin(q3)*np.sin(q4 + self.theta1) + self.l5*np.sin(q2)*np.sin(q3)*np.sin(q4)*np.cos(q6 - self.theta2) - self.l5*np.sin(q2)*np.sin(q3)*np.sin(q6 - self.theta2)*np.cos(q4)*np.cos(q5) + self.l5*np.sin(q2)*np.sin(q5)*np.sin(q6 - self.theta2)*np.cos(q3)

        J_34 = -self.l4*np.sin(q2)*np.cos(q3)*np.cos(q4 + self.theta1) + self.l4*np.sin(q4 + self.theta1)*np.cos(q2) - self.l5*np.sin(q2)*np.sin(q4)*np.sin(q6 - self.theta2)*np.cos(q3)*np.cos(q5) - self.l5*np.sin(q2)*np.cos(q3)*np.cos(q4)*np.cos(q6 - self.theta2) + self.l5*np.sin(q4)*np.cos(q2)*np.cos(q6 - self.theta2) - self.l5*np.sin(q6 - self.theta2)*np.cos(q2)*np.cos(q4)*np.cos(q5)

        J_35 = self.l5*np.sin(q2)*np.sin(q3)*np.sin(q6 - self.theta2)*np.cos(q5) - self.l5*np.sin(q2)*np.sin(q5)*np.sin(q6 - self.theta2)*np.cos(q3)*np.cos(q4) + self.l5*np.sin(q4)*np.sin(q5)*np.sin(q6 - self.theta2)*np.cos(q2)

        J_36 = self.l5*np.sin(q2)*np.sin(q3)*np.sin(q5)*np.cos(q6 - self.theta2) + self.l5*np.sin(q2)*np.sin(q4)*np.sin(q6 - self.theta2)*np.cos(q3) + self.l5*np.sin(q2)*np.cos(q3)*np.cos(q4)*np.cos(q5)*np.cos(q6 - self.theta2) - self.l5*np.sin(q4)*np.cos(q2)*np.cos(q5)*np.cos(q6 - self.theta2) + self.l5*np.sin(q6 - self.theta2)*np.cos(q2)*np.cos(q4)


        J_37 = 0

        J = np.matrix([[J_11, J_12, J_13, J_14, J_15, J_16, J_17],
                       [J_21, J_22, J_23, J_24, J_25, J_26, J_27],
                       [J_31, J_32, J_33, J_34, J_35, J_36, J_37]])
        return J


    
    def compute_ksis(self, r_joints_array, obs1_pos_x , obs1_pos_y, obs2_pos_x, obs2_pos_y):

    #we compute all ksis for the 2nd subtask, using the real joint states positions and derivating the objective function c = ||p(q) - o|| with every q (where p(q) is a critical point on the robot and o is a point on the obstacle)

    #the chosen critical points are mentioned in the report

        q1 = r_joints_array[0]
        q2 = r_joints_array[1]
        q3 = r_joints_array[2]
        q4 = r_joints_array[3]

        a1  = obs1_pos_x
        b1  = obs1_pos_y + 0.05 #a1, b1 are the position of green obstacle, plus the radix 5cm
        a2  = obs2_pos_x
        b2  = obs2_pos_y - 0.05 #a2, b2 are the position of red obstacle, minus the radix 5cm

    #for each chosen critical point, we already know which obstacle we want to avoid, so we select the appropriate a,b

        ksi1 = np.zeros(7)    #7 represents the 7 critical points
        ksi2 = np.zeros(7)
        ksi3 = np.zeros(7)
        ksi4 = np.zeros(7)
        ksi5 = np.zeros(7)
        ksi6 = np.zeros(7)
        ksi7 = np.zeros(7)    #ksi1 to ksi7 represent the partial derivatives for each qi, i= 1,2,...,7
        
        #1o shmeio (L1)
        
        ksi1[0] = ((-2*self.l2*np.sin(q1)*np.sin(q2) + 2*self.l3*(-np.sin(q1)*np.cos(q2)*np.cos(q3) - np.sin(q3)*np.cos(q1)) + 2*(-0.0445473*np.sin(q1)*np.cos(q2)*np.cos(q3) - 0.0445473*np.sin(q3)*np.cos(q1))*np.sin(q4) + 2*(0.0445473*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0445473*np.sin(q3)*np.cos(q1))*np.cos(q4) + 0.0890946*np.sin(q1)*np.sin(q2)*np.sin(q4) + 0.0890946*np.sin(q1)*np.sin(q2)*np.cos(q4) - 0.2124*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.2124*np.cos(q1)*np.cos(q3))*(-a1 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.0445473*np.sin(q1)*np.sin(q3) + 0.0445473*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) - (-0.0445473*np.sin(q1)*np.sin(q3) + 0.0445473*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) + 0.1062*np.sin(q1)*np.cos(q3) - 0.0445473*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.0445473*np.sin(q2)*np.cos(q1)*np.cos(q4) + 0.1062*np.sin(q3)*np.cos(q1)*np.cos(q2))/2 + (2*self.l2*np.sin(q2)*np.cos(q1) + 2*self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + 2*(-0.0445473*np.sin(q1)*np.sin(q3) + 0.0445473*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + 2*(0.0445473*np.sin(q1)*np.sin(q3) - 0.0445473*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) + 0.2124*np.sin(q1)*np.cos(q3) - 0.0890946*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.0890946*np.sin(q2)*np.cos(q1)*np.cos(q4) + 0.2124*np.sin(q3)*np.cos(q1)*np.cos(q2))*(-b1 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.0445473*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0445473*np.sin(q3)*np.cos(q1))*np.sin(q4) - (0.0445473*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0445473*np.sin(q3)*np.cos(q1))*np.cos(q4) - 0.0445473*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.0445473*np.sin(q1)*np.sin(q2)*np.cos(q4) + 0.1062*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.1062*np.cos(q1)*np.cos(q3))/2)/np.sqrt((-a1 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.0445473*np.sin(q1)*np.sin(q3) + 0.0445473*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) - (-0.0445473*np.sin(q1)*np.sin(q3) + 0.0445473*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) + 0.1062*np.sin(q1)*np.cos(q3) - 0.0445473*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.0445473*np.sin(q2)*np.cos(q1)*np.cos(q4) + 0.1062*np.sin(q3)*np.cos(q1)*np.cos(q2))**2 + (-b1 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.0445473*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0445473*np.sin(q3)*np.cos(q1))*np.sin(q4) - (0.0445473*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0445473*np.sin(q3)*np.cos(q1))*np.cos(q4) - 0.0445473*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.0445473*np.sin(q1)*np.sin(q2)*np.cos(q4) + 0.1062*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.1062*np.cos(q1)*np.cos(q3))**2)
        
        ksi2[0] = ((2*self.l2*np.sin(q1)*np.cos(q2) - 2*self.l3*np.sin(q1)*np.sin(q2)*np.cos(q3) - 0.2124*np.sin(q1)*np.sin(q2)*np.sin(q3) - 0.0890946*np.sin(q1)*np.sin(q2)*np.sin(q4)*np.cos(q3) + 0.0890946*np.sin(q1)*np.sin(q2)*np.cos(q3)*np.cos(q4) - 0.0890946*np.sin(q1)*np.sin(q4)*np.cos(q2) - 0.0890946*np.sin(q1)*np.cos(q2)*np.cos(q4))*(-b1 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.0445473*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0445473*np.sin(q3)*np.cos(q1))*np.sin(q4) - (0.0445473*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0445473*np.sin(q3)*np.cos(q1))*np.cos(q4) - 0.0445473*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.0445473*np.sin(q1)*np.sin(q2)*np.cos(q4) + 0.1062*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.1062*np.cos(q1)*np.cos(q3))/2 + (2*self.l2*np.cos(q1)*np.cos(q2) - 2*self.l3*np.sin(q2)*np.cos(q1)*np.cos(q3) - 0.2124*np.sin(q2)*np.sin(q3)*np.cos(q1) - 0.0890946*np.sin(q2)*np.sin(q4)*np.cos(q1)*np.cos(q3) + 0.0890946*np.sin(q2)*np.cos(q1)*np.cos(q3)*np.cos(q4) - 0.0890946*np.sin(q4)*np.cos(q1)*np.cos(q2) - 0.0890946*np.cos(q1)*np.cos(q2)*np.cos(q4))*(-a1 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.0445473*np.sin(q1)*np.sin(q3) + 0.0445473*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) - (-0.0445473*np.sin(q1)*np.sin(q3) + 0.0445473*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) + 0.1062*np.sin(q1)*np.cos(q3) - 0.0445473*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.0445473*np.sin(q2)*np.cos(q1)*np.cos(q4) + 0.1062*np.sin(q3)*np.cos(q1)*np.cos(q2))/2)/np.sqrt((-a1 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.0445473*np.sin(q1)*np.sin(q3) + 0.0445473*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) - (-0.0445473*np.sin(q1)*np.sin(q3) + 0.0445473*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) + 0.1062*np.sin(q1)*np.cos(q3) - 0.0445473*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.0445473*np.sin(q2)*np.cos(q1)*np.cos(q4) + 0.1062*np.sin(q3)*np.cos(q1)*np.cos(q2))**2 + (-b1 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.0445473*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0445473*np.sin(q3)*np.cos(q1))*np.sin(q4) - (0.0445473*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0445473*np.sin(q3)*np.cos(q1))*np.cos(q4) - 0.0445473*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.0445473*np.sin(q1)*np.sin(q2)*np.cos(q4) + 0.1062*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.1062*np.cos(q1)*np.cos(q3))**2)
        
        ksi3[0] = ((2*self.l3*(-np.sin(q1)*np.cos(q3) - np.sin(q3)*np.cos(q1)*np.cos(q2)) + 2*(-0.0445473*np.sin(q1)*np.cos(q3) - 0.0445473*np.sin(q3)*np.cos(q1)*np.cos(q2))*np.sin(q4) + 2*(0.0445473*np.sin(q1)*np.cos(q3) + 0.0445473*np.sin(q3)*np.cos(q1)*np.cos(q2))*np.cos(q4) - 0.2124*np.sin(q1)*np.sin(q3) + 0.2124*np.cos(q1)*np.cos(q2)*np.cos(q3))*(-a1 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.0445473*np.sin(q1)*np.sin(q3) + 0.0445473*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) - (-0.0445473*np.sin(q1)*np.sin(q3) + 0.0445473*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) + 0.1062*np.sin(q1)*np.cos(q3) - 0.0445473*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.0445473*np.sin(q2)*np.cos(q1)*np.cos(q4) + 0.1062*np.sin(q3)*np.cos(q1)*np.cos(q2))/2 + (2*self.l3*(-np.sin(q1)*np.sin(q3)*np.cos(q2) + np.cos(q1)*np.cos(q3)) + 2*(-0.0445473*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0445473*np.cos(q1)*np.cos(q3))*np.sin(q4) + 2*(0.0445473*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.0445473*np.cos(q1)*np.cos(q3))*np.cos(q4) + 0.2124*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.2124*np.sin(q3)*np.cos(q1))*(-b1 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.0445473*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0445473*np.sin(q3)*np.cos(q1))*np.sin(q4) - (0.0445473*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0445473*np.sin(q3)*np.cos(q1))*np.cos(q4) - 0.0445473*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.0445473*np.sin(q1)*np.sin(q2)*np.cos(q4) + 0.1062*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.1062*np.cos(q1)*np.cos(q3))/2)/np.sqrt((-a1 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.0445473*np.sin(q1)*np.sin(q3) + 0.0445473*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) - (-0.0445473*np.sin(q1)*np.sin(q3) + 0.0445473*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) + 0.1062*np.sin(q1)*np.cos(q3) - 0.0445473*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.0445473*np.sin(q2)*np.cos(q1)*np.cos(q4) + 0.1062*np.sin(q3)*np.cos(q1)*np.cos(q2))**2 + (-b1 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.0445473*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0445473*np.sin(q3)*np.cos(q1))*np.sin(q4) - (0.0445473*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0445473*np.sin(q3)*np.cos(q1))*np.cos(q4) - 0.0445473*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.0445473*np.sin(q1)*np.sin(q2)*np.cos(q4) + 0.1062*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.1062*np.cos(q1)*np.cos(q3))**2)
        
        ksi4[0] = ((2*(-0.0445473*np.sin(q1)*np.sin(q3) + 0.0445473*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 2*(0.0445473*np.sin(q1)*np.sin(q3) - 0.0445473*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + 0.0890946*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.0890946*np.sin(q2)*np.cos(q1)*np.cos(q4))*(-a1 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.0445473*np.sin(q1)*np.sin(q3) + 0.0445473*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) - (-0.0445473*np.sin(q1)*np.sin(q3) + 0.0445473*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) + 0.1062*np.sin(q1)*np.cos(q3) - 0.0445473*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.0445473*np.sin(q2)*np.cos(q1)*np.cos(q4) + 0.1062*np.sin(q3)*np.cos(q1)*np.cos(q2))/2 + (-2*(-0.0445473*np.sin(q1)*np.cos(q2)*np.cos(q3) - 0.0445473*np.sin(q3)*np.cos(q1))*np.sin(q4) + 2*(0.0445473*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0445473*np.sin(q3)*np.cos(q1))*np.cos(q4) + 0.0890946*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.0890946*np.sin(q1)*np.sin(q2)*np.cos(q4))*(-b1 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.0445473*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0445473*np.sin(q3)*np.cos(q1))*np.sin(q4) - (0.0445473*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0445473*np.sin(q3)*np.cos(q1))*np.cos(q4) - 0.0445473*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.0445473*np.sin(q1)*np.sin(q2)*np.cos(q4) + 0.1062*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.1062*np.cos(q1)*np.cos(q3))/2)/np.sqrt((-a1 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.0445473*np.sin(q1)*np.sin(q3) + 0.0445473*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) - (-0.0445473*np.sin(q1)*np.sin(q3) + 0.0445473*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) + 0.1062*np.sin(q1)*np.cos(q3) - 0.0445473*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.0445473*np.sin(q2)*np.cos(q1)*np.cos(q4) + 0.1062*np.sin(q3)*np.cos(q1)*np.cos(q2))**2 + (-b1 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.0445473*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0445473*np.sin(q3)*np.cos(q1))*np.sin(q4) - (0.0445473*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0445473*np.sin(q3)*np.cos(q1))*np.cos(q4) - 0.0445473*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.0445473*np.sin(q1)*np.sin(q2)*np.cos(q4) + 0.1062*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.1062*np.cos(q1)*np.cos(q3))**2)

        ksi5[0] = 0
        ksi6[0] = 0
        ksi7[0] = 0
        
        
        #2o shmeio (L2)
        
        ksi1[1] = ((-2*self.l2*np.sin(q1)*np.sin(q2) + 2*self.l3*(-np.sin(q1)*np.cos(q2)*np.cos(q3) - np.sin(q3)*np.cos(q1)) + 2*(-0.0799023*np.sin(q1)*np.cos(q2)*np.cos(q3) - 0.0799023*np.sin(q3)*np.cos(q1))*np.sin(q4) + 2*(0.0091923*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0091923*np.sin(q3)*np.cos(q1))*np.cos(q4) + 0.0183846*np.sin(q1)*np.sin(q2)*np.sin(q4) + 0.1598046*np.sin(q1)*np.sin(q2)*np.cos(q4) - 0.2124*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.2124*np.cos(q1)*np.cos(q3))*(-a1 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.0799023*np.sin(q1)*np.sin(q3) + 0.0799023*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) - (-0.0091923*np.sin(q1)*np.sin(q3) + 0.0091923*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) + 0.1062*np.sin(q1)*np.cos(q3) - 0.0091923*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.0799023*np.sin(q2)*np.cos(q1)*np.cos(q4) + 0.1062*np.sin(q3)*np.cos(q1)*np.cos(q2))/2 + (2*self.l2*np.sin(q2)*np.cos(q1) + 2*self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + 2*(-0.0799023*np.sin(q1)*np.sin(q3) + 0.0799023*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + 2*(0.0091923*np.sin(q1)*np.sin(q3) - 0.0091923*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) + 0.2124*np.sin(q1)*np.cos(q3) - 0.0183846*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.1598046*np.sin(q2)*np.cos(q1)*np.cos(q4) + 0.2124*np.sin(q3)*np.cos(q1)*np.cos(q2))*(-b1 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) - (0.0091923*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0091923*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.0799023*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0799023*np.sin(q3)*np.cos(q1))*np.sin(q4) - 0.0091923*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.0799023*np.sin(q1)*np.sin(q2)*np.cos(q4) + 0.1062*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.1062*np.cos(q1)*np.cos(q3))/2)/np.sqrt((-a1 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.0799023*np.sin(q1)*np.sin(q3) + 0.0799023*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) - (-0.0091923*np.sin(q1)*np.sin(q3) + 0.0091923*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) + 0.1062*np.sin(q1)*np.cos(q3) - 0.0091923*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.0799023*np.sin(q2)*np.cos(q1)*np.cos(q4) + 0.1062*np.sin(q3)*np.cos(q1)*np.cos(q2))**2 + (-b1 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) - (0.0091923*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0091923*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.0799023*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0799023*np.sin(q3)*np.cos(q1))*np.sin(q4) - 0.0091923*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.0799023*np.sin(q1)*np.sin(q2)*np.cos(q4) + 0.1062*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.1062*np.cos(q1)*np.cos(q3))**2)
        
        ksi2[1] = ((2*self.l2*np.sin(q1)*np.cos(q2) - 2*self.l3*np.sin(q1)*np.sin(q2)*np.cos(q3) - 0.2124*np.sin(q1)*np.sin(q2)*np.sin(q3) - 0.1598046*np.sin(q1)*np.sin(q2)*np.sin(q4)*np.cos(q3) + 0.0183846*np.sin(q1)*np.sin(q2)*np.cos(q3)*np.cos(q4) - 0.0183846*np.sin(q1)*np.sin(q4)*np.cos(q2) - 0.1598046*np.sin(q1)*np.cos(q2)*np.cos(q4))*(-b1 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) - (0.0091923*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0091923*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.0799023*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0799023*np.sin(q3)*np.cos(q1))*np.sin(q4) - 0.0091923*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.0799023*np.sin(q1)*np.sin(q2)*np.cos(q4) + 0.1062*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.1062*np.cos(q1)*np.cos(q3))/2 + (2*self.l2*np.cos(q1)*np.cos(q2) - 2*self.l3*np.sin(q2)*np.cos(q1)*np.cos(q3) - 0.2124*np.sin(q2)*np.sin(q3)*np.cos(q1) - 0.1598046*np.sin(q2)*np.sin(q4)*np.cos(q1)*np.cos(q3) + 0.0183846*np.sin(q2)*np.cos(q1)*np.cos(q3)*np.cos(q4) - 0.0183846*np.sin(q4)*np.cos(q1)*np.cos(q2) - 0.1598046*np.cos(q1)*np.cos(q2)*np.cos(q4))*(-a1 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.0799023*np.sin(q1)*np.sin(q3) + 0.0799023*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) - (-0.0091923*np.sin(q1)*np.sin(q3) + 0.0091923*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) + 0.1062*np.sin(q1)*np.cos(q3) - 0.0091923*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.0799023*np.sin(q2)*np.cos(q1)*np.cos(q4) + 0.1062*np.sin(q3)*np.cos(q1)*np.cos(q2))/2)/np.sqrt((-a1 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.0799023*np.sin(q1)*np.sin(q3) + 0.0799023*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) - (-0.0091923*np.sin(q1)*np.sin(q3) + 0.0091923*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) + 0.1062*np.sin(q1)*np.cos(q3) - 0.0091923*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.0799023*np.sin(q2)*np.cos(q1)*np.cos(q4) + 0.1062*np.sin(q3)*np.cos(q1)*np.cos(q2))**2 + (-b1 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) - (0.0091923*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0091923*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.0799023*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0799023*np.sin(q3)*np.cos(q1))*np.sin(q4) - 0.0091923*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.0799023*np.sin(q1)*np.sin(q2)*np.cos(q4) + 0.1062*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.1062*np.cos(q1)*np.cos(q3))**2)
        
        ksi3[1] = ((2*self.l3*(-np.sin(q1)*np.cos(q3) - np.sin(q3)*np.cos(q1)*np.cos(q2)) + 2*(-0.0799023*np.sin(q1)*np.cos(q3) - 0.0799023*np.sin(q3)*np.cos(q1)*np.cos(q2))*np.sin(q4) + 2*(0.0091923*np.sin(q1)*np.cos(q3) + 0.0091923*np.sin(q3)*np.cos(q1)*np.cos(q2))*np.cos(q4) - 0.2124*np.sin(q1)*np.sin(q3) + 0.2124*np.cos(q1)*np.cos(q2)*np.cos(q3))*(-a1 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.0799023*np.sin(q1)*np.sin(q3) + 0.0799023*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) - (-0.0091923*np.sin(q1)*np.sin(q3) + 0.0091923*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) + 0.1062*np.sin(q1)*np.cos(q3) - 0.0091923*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.0799023*np.sin(q2)*np.cos(q1)*np.cos(q4) + 0.1062*np.sin(q3)*np.cos(q1)*np.cos(q2))/2 + (2*self.l3*(-np.sin(q1)*np.sin(q3)*np.cos(q2) + np.cos(q1)*np.cos(q3)) + 2*(-0.0799023*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0799023*np.cos(q1)*np.cos(q3))*np.sin(q4) + 2*(0.0091923*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.0091923*np.cos(q1)*np.cos(q3))*np.cos(q4) + 0.2124*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.2124*np.sin(q3)*np.cos(q1))*(-b1 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) - (0.0091923*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0091923*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.0799023*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0799023*np.sin(q3)*np.cos(q1))*np.sin(q4) - 0.0091923*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.0799023*np.sin(q1)*np.sin(q2)*np.cos(q4) + 0.1062*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.1062*np.cos(q1)*np.cos(q3))/2)/np.sqrt((-a1 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.0799023*np.sin(q1)*np.sin(q3) + 0.0799023*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) - (-0.0091923*np.sin(q1)*np.sin(q3) + 0.0091923*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) + 0.1062*np.sin(q1)*np.cos(q3) - 0.0091923*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.0799023*np.sin(q2)*np.cos(q1)*np.cos(q4) + 0.1062*np.sin(q3)*np.cos(q1)*np.cos(q2))**2 + (-b1 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) - (0.0091923*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0091923*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.0799023*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0799023*np.sin(q3)*np.cos(q1))*np.sin(q4) - 0.0091923*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.0799023*np.sin(q1)*np.sin(q2)*np.cos(q4) + 0.1062*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.1062*np.cos(q1)*np.cos(q3))**2)
        
        ksi4[1] = ((2*(-0.0799023*np.sin(q1)*np.sin(q3) + 0.0799023*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 2*(0.0091923*np.sin(q1)*np.sin(q3) - 0.0091923*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + 0.1598046*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.0183846*np.sin(q2)*np.cos(q1)*np.cos(q4))*(-a1 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.0799023*np.sin(q1)*np.sin(q3) + 0.0799023*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) - (-0.0091923*np.sin(q1)*np.sin(q3) + 0.0091923*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) + 0.1062*np.sin(q1)*np.cos(q3) - 0.0091923*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.0799023*np.sin(q2)*np.cos(q1)*np.cos(q4) + 0.1062*np.sin(q3)*np.cos(q1)*np.cos(q2))/2 + (-2*(-0.0091923*np.sin(q1)*np.cos(q2)*np.cos(q3) - 0.0091923*np.sin(q3)*np.cos(q1))*np.sin(q4) + 2*(0.0799023*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0799023*np.sin(q3)*np.cos(q1))*np.cos(q4) + 0.1598046*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.0183846*np.sin(q1)*np.sin(q2)*np.cos(q4))*(-b1 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) - (0.0091923*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0091923*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.0799023*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0799023*np.sin(q3)*np.cos(q1))*np.sin(q4) - 0.0091923*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.0799023*np.sin(q1)*np.sin(q2)*np.cos(q4) + 0.1062*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.1062*np.cos(q1)*np.cos(q3))/2)/np.sqrt((-a1 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.0799023*np.sin(q1)*np.sin(q3) + 0.0799023*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) - (-0.0091923*np.sin(q1)*np.sin(q3) + 0.0091923*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) + 0.1062*np.sin(q1)*np.cos(q3) - 0.0091923*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.0799023*np.sin(q2)*np.cos(q1)*np.cos(q4) + 0.1062*np.sin(q3)*np.cos(q1)*np.cos(q2))**2 + (-b1 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) - (0.0091923*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0091923*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.0799023*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0799023*np.sin(q3)*np.cos(q1))*np.sin(q4) - 0.0091923*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.0799023*np.sin(q1)*np.sin(q2)*np.cos(q4) + 0.1062*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.1062*np.cos(q1)*np.cos(q3))**2)
        
        ksi5[1] = 0
        ksi6[1] = 0
        ksi7[1] = 0
        
        
        #3o shmeio (L3)
        
        ksi1[2] = ((-2*self.l2*np.sin(q1)*np.sin(q2) + 2*self.l3*(-np.sin(q1)*np.cos(q2)*np.cos(q3) - np.sin(q3)*np.cos(q1)) + 2*(-0.1152573*np.sin(q1)*np.cos(q2)*np.cos(q3) - 0.1152573*np.sin(q3)*np.cos(q1))*np.sin(q4) + 2*(-0.0261627*np.sin(q1)*np.cos(q2)*np.cos(q3) - 0.0261627*np.sin(q3)*np.cos(q1))*np.cos(q4) - 0.0523254*np.sin(q1)*np.sin(q2)*np.sin(q4) + 0.2305146*np.sin(q1)*np.sin(q2)*np.cos(q4) - 0.2124*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.2124*np.cos(q1)*np.cos(q3))*(-a1 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.1152573*np.sin(q1)*np.sin(q3) + 0.1152573*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.0261627*np.sin(q1)*np.sin(q3) + 0.0261627*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) + 0.1062*np.sin(q1)*np.cos(q3) + 0.0261627*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.1152573*np.sin(q2)*np.cos(q1)*np.cos(q4) + 0.1062*np.sin(q3)*np.cos(q1)*np.cos(q2))/2 + (2*self.l2*np.sin(q2)*np.cos(q1) + 2*self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + 2*(-0.1152573*np.sin(q1)*np.sin(q3) + 0.1152573*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + 2*(-0.0261627*np.sin(q1)*np.sin(q3) + 0.0261627*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) + 0.2124*np.sin(q1)*np.cos(q3) + 0.0523254*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.2305146*np.sin(q2)*np.cos(q1)*np.cos(q4) + 0.2124*np.sin(q3)*np.cos(q1)*np.cos(q2))*(-b1 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.0261627*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0261627*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.1152573*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.1152573*np.sin(q3)*np.cos(q1))*np.sin(q4) + 0.0261627*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.1152573*np.sin(q1)*np.sin(q2)*np.cos(q4) + 0.1062*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.1062*np.cos(q1)*np.cos(q3))/2)/np.sqrt((-a1 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.1152573*np.sin(q1)*np.sin(q3) + 0.1152573*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.0261627*np.sin(q1)*np.sin(q3) + 0.0261627*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) + 0.1062*np.sin(q1)*np.cos(q3) + 0.0261627*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.1152573*np.sin(q2)*np.cos(q1)*np.cos(q4) + 0.1062*np.sin(q3)*np.cos(q1)*np.cos(q2))**2 + (-b1 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.0261627*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0261627*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.1152573*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.1152573*np.sin(q3)*np.cos(q1))*np.sin(q4) + 0.0261627*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.1152573*np.sin(q1)*np.sin(q2)*np.cos(q4) + 0.1062*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.1062*np.cos(q1)*np.cos(q3))**2)
        
        ksi2[2] = ((2*self.l2*np.sin(q1)*np.cos(q2) - 2*self.l3*np.sin(q1)*np.sin(q2)*np.cos(q3) - 0.2124*np.sin(q1)*np.sin(q2)*np.sin(q3) - 0.2305146*np.sin(q1)*np.sin(q2)*np.sin(q4)*np.cos(q3) - 0.0523254*np.sin(q1)*np.sin(q2)*np.cos(q3)*np.cos(q4) + 0.0523254*np.sin(q1)*np.sin(q4)*np.cos(q2) - 0.2305146*np.sin(q1)*np.cos(q2)*np.cos(q4))*(-b1 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.0261627*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0261627*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.1152573*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.1152573*np.sin(q3)*np.cos(q1))*np.sin(q4) + 0.0261627*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.1152573*np.sin(q1)*np.sin(q2)*np.cos(q4) + 0.1062*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.1062*np.cos(q1)*np.cos(q3))/2 + (2*self.l2*np.cos(q1)*np.cos(q2) - 2*self.l3*np.sin(q2)*np.cos(q1)*np.cos(q3) - 0.2124*np.sin(q2)*np.sin(q3)*np.cos(q1) - 0.2305146*np.sin(q2)*np.sin(q4)*np.cos(q1)*np.cos(q3) - 0.0523254*np.sin(q2)*np.cos(q1)*np.cos(q3)*np.cos(q4) + 0.0523254*np.sin(q4)*np.cos(q1)*np.cos(q2) - 0.2305146*np.cos(q1)*np.cos(q2)*np.cos(q4))*(-a1 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.1152573*np.sin(q1)*np.sin(q3) + 0.1152573*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.0261627*np.sin(q1)*np.sin(q3) + 0.0261627*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) + 0.1062*np.sin(q1)*np.cos(q3) + 0.0261627*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.1152573*np.sin(q2)*np.cos(q1)*np.cos(q4) + 0.1062*np.sin(q3)*np.cos(q1)*np.cos(q2))/2)/np.sqrt((-a1 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.1152573*np.sin(q1)*np.sin(q3) + 0.1152573*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.0261627*np.sin(q1)*np.sin(q3) + 0.0261627*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) + 0.1062*np.sin(q1)*np.cos(q3) + 0.0261627*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.1152573*np.sin(q2)*np.cos(q1)*np.cos(q4) + 0.1062*np.sin(q3)*np.cos(q1)*np.cos(q2))**2 + (-b1 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.0261627*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0261627*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.1152573*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.1152573*np.sin(q3)*np.cos(q1))*np.sin(q4) + 0.0261627*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.1152573*np.sin(q1)*np.sin(q2)*np.cos(q4) + 0.1062*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.1062*np.cos(q1)*np.cos(q3))**2)
        
        ksi3[2] = ((2*self.l3*(-np.sin(q1)*np.cos(q3) - np.sin(q3)*np.cos(q1)*np.cos(q2)) + 2*(-0.1152573*np.sin(q1)*np.cos(q3) - 0.1152573*np.sin(q3)*np.cos(q1)*np.cos(q2))*np.sin(q4) + 2*(-0.0261627*np.sin(q1)*np.cos(q3) - 0.0261627*np.sin(q3)*np.cos(q1)*np.cos(q2))*np.cos(q4) - 0.2124*np.sin(q1)*np.sin(q3) + 0.2124*np.cos(q1)*np.cos(q2)*np.cos(q3))*(-a1 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.1152573*np.sin(q1)*np.sin(q3) + 0.1152573*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.0261627*np.sin(q1)*np.sin(q3) + 0.0261627*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) + 0.1062*np.sin(q1)*np.cos(q3) + 0.0261627*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.1152573*np.sin(q2)*np.cos(q1)*np.cos(q4) + 0.1062*np.sin(q3)*np.cos(q1)*np.cos(q2))/2 + (2*self.l3*(-np.sin(q1)*np.sin(q3)*np.cos(q2) + np.cos(q1)*np.cos(q3)) + 2*(-0.1152573*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.1152573*np.cos(q1)*np.cos(q3))*np.sin(q4) + 2*(-0.0261627*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0261627*np.cos(q1)*np.cos(q3))*np.cos(q4) + 0.2124*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.2124*np.sin(q3)*np.cos(q1))*(-b1 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.0261627*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0261627*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.1152573*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.1152573*np.sin(q3)*np.cos(q1))*np.sin(q4) + 0.0261627*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.1152573*np.sin(q1)*np.sin(q2)*np.cos(q4) + 0.1062*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.1062*np.cos(q1)*np.cos(q3))/2)/np.sqrt((-a1 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.1152573*np.sin(q1)*np.sin(q3) + 0.1152573*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.0261627*np.sin(q1)*np.sin(q3) + 0.0261627*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) + 0.1062*np.sin(q1)*np.cos(q3) + 0.0261627*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.1152573*np.sin(q2)*np.cos(q1)*np.cos(q4) + 0.1062*np.sin(q3)*np.cos(q1)*np.cos(q2))**2 + (-b1 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.0261627*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0261627*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.1152573*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.1152573*np.sin(q3)*np.cos(q1))*np.sin(q4) + 0.0261627*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.1152573*np.sin(q1)*np.sin(q2)*np.cos(q4) + 0.1062*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.1062*np.cos(q1)*np.cos(q3))**2)
        
        ksi4[2] = ((2*(-0.1152573*np.sin(q1)*np.sin(q3) + 0.1152573*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 2*(-0.0261627*np.sin(q1)*np.sin(q3) + 0.0261627*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + 0.2305146*np.sin(q2)*np.sin(q4)*np.cos(q1) + 0.0523254*np.sin(q2)*np.cos(q1)*np.cos(q4))*(-a1 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.1152573*np.sin(q1)*np.sin(q3) + 0.1152573*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.0261627*np.sin(q1)*np.sin(q3) + 0.0261627*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) + 0.1062*np.sin(q1)*np.cos(q3) + 0.0261627*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.1152573*np.sin(q2)*np.cos(q1)*np.cos(q4) + 0.1062*np.sin(q3)*np.cos(q1)*np.cos(q2))/2 + (-2*(0.0261627*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0261627*np.sin(q3)*np.cos(q1))*np.sin(q4) + 2*(0.1152573*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.1152573*np.sin(q3)*np.cos(q1))*np.cos(q4) + 0.2305146*np.sin(q1)*np.sin(q2)*np.sin(q4) + 0.0523254*np.sin(q1)*np.sin(q2)*np.cos(q4))*(-b1 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.0261627*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0261627*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.1152573*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.1152573*np.sin(q3)*np.cos(q1))*np.sin(q4) + 0.0261627*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.1152573*np.sin(q1)*np.sin(q2)*np.cos(q4) + 0.1062*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.1062*np.cos(q1)*np.cos(q3))/2)/np.sqrt((-a1 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.1152573*np.sin(q1)*np.sin(q3) + 0.1152573*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.0261627*np.sin(q1)*np.sin(q3) + 0.0261627*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) + 0.1062*np.sin(q1)*np.cos(q3) + 0.0261627*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.1152573*np.sin(q2)*np.cos(q1)*np.cos(q4) + 0.1062*np.sin(q3)*np.cos(q1)*np.cos(q2))**2 + (-b1 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.0261627*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.0261627*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.1152573*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.1152573*np.sin(q3)*np.cos(q1))*np.sin(q4) + 0.0261627*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.1152573*np.sin(q1)*np.sin(q2)*np.cos(q4) + 0.1062*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.1062*np.cos(q1)*np.cos(q3))**2)
        
        ksi5[2] = 0
        ksi6[2] = 0
        ksi7[2] = 0
    
        #4o shmeio (L4)
    
        ksi1[3] = ((-2*self.l2*np.sin(q1)*np.sin(q2) + 2*self.l3*(-np.sin(q1)*np.cos(q2)*np.cos(q3) - np.sin(q3)*np.cos(q1)) + 0.1352*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.1352*np.cos(q1)*np.cos(q3))*(-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) - 0.0676*np.sin(q1)*np.cos(q3) - 0.0676*np.sin(q3)*np.cos(q1)*np.cos(q2))/2 + (2*self.l2*np.sin(q2)*np.cos(q1) + 2*self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) - 0.1352*np.sin(q1)*np.cos(q3) - 0.1352*np.sin(q3)*np.cos(q1)*np.cos(q2))*(-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) - 0.0676*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0676*np.cos(q1)*np.cos(q3))/2)/np.sqrt((-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) - 0.0676*np.sin(q1)*np.cos(q3) - 0.0676*np.sin(q3)*np.cos(q1)*np.cos(q2))**2 + (-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) - 0.0676*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0676*np.cos(q1)*np.cos(q3))**2)
    
        ksi2[3] = ((2*self.l2*np.sin(q1)*np.cos(q2) - 2*self.l3*np.sin(q1)*np.sin(q2)*np.cos(q3) + 0.1352*np.sin(q1)*np.sin(q2)*np.sin(q3))*(-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) - 0.0676*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0676*np.cos(q1)*np.cos(q3))/2 + (2*self.l2*np.cos(q1)*np.cos(q2) - 2*self.l3*np.sin(q2)*np.cos(q1)*np.cos(q3) + 0.1352*np.sin(q2)*np.sin(q3)*np.cos(q1))*(-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) - 0.0676*np.sin(q1)*np.cos(q3) - 0.0676*np.sin(q3)*np.cos(q1)*np.cos(q2))/2)/np.sqrt((-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) - 0.0676*np.sin(q1)*np.cos(q3) - 0.0676*np.sin(q3)*np.cos(q1)*np.cos(q2))**2 + (-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) - 0.0676*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0676*np.cos(q1)*np.cos(q3))**2)
    
        ksi3[3] = ((2*self.l3*(-np.sin(q1)*np.cos(q3) - np.sin(q3)*np.cos(q1)*np.cos(q2)) + 0.1352*np.sin(q1)*np.sin(q3) - 0.1352*np.cos(q1)*np.cos(q2)*np.cos(q3))*(-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) - 0.0676*np.sin(q1)*np.cos(q3) - 0.0676*np.sin(q3)*np.cos(q1)*np.cos(q2))/2 + (2*self.l3*(-np.sin(q1)*np.sin(q3)*np.cos(q2) + np.cos(q1)*np.cos(q3)) - 0.1352*np.sin(q1)*np.cos(q2)*np.cos(q3) - 0.1352*np.sin(q3)*np.cos(q1))*(-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) - 0.0676*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0676*np.cos(q1)*np.cos(q3))/2)/np.sqrt((-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) - 0.0676*np.sin(q1)*np.cos(q3) - 0.0676*np.sin(q3)*np.cos(q1)*np.cos(q2))**2 + (-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) - 0.0676*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0676*np.cos(q1)*np.cos(q3))**2)
        
        ksi4[3] = 0
        ksi5[3] = 0
        ksi6[3] = 0
        ksi7[3] = 0
        
        #5o shmeio (L5)
        
        ksi1[4] = ((-2*self.l2*np.sin(q1)*np.sin(q2) + 2*self.l3*(-np.sin(q1)*np.cos(q2)*np.cos(q3) - np.sin(q3)*np.cos(q1)) + 2*(-0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) - 0.07071*np.sin(q3)*np.cos(q1))*np.sin(q4) + 2*(-0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) - 0.07071*np.sin(q3)*np.cos(q1))*np.cos(q4) - 0.14142*np.sin(q1)*np.sin(q2)*np.sin(q4) + 0.14142*np.sin(q1)*np.sin(q2)*np.cos(q4) + 0.0822*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.0822*np.cos(q1)*np.cos(q3))*(-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 0.0411*np.sin(q1)*np.cos(q3) + 0.07071*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.07071*np.sin(q2)*np.cos(q1)*np.cos(q4) - 0.0411*np.sin(q3)*np.cos(q1)*np.cos(q2))/2 + (2*self.l2*np.sin(q2)*np.cos(q1) + 2*self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + 2*(-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + 2*(-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 0.0822*np.sin(q1)*np.cos(q3) + 0.14142*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.14142*np.sin(q2)*np.cos(q1)*np.cos(q4) - 0.0822*np.sin(q3)*np.cos(q1)*np.cos(q2))*(-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.sin(q4) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.cos(q4) + 0.07071*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.07071*np.sin(q1)*np.sin(q2)*np.cos(q4) - 0.0411*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0411*np.cos(q1)*np.cos(q3))/2)/np.sqrt((-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 0.0411*np.sin(q1)*np.cos(q3) + 0.07071*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.07071*np.sin(q2)*np.cos(q1)*np.cos(q4) - 0.0411*np.sin(q3)*np.cos(q1)*np.cos(q2))**2 + (-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.sin(q4) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.cos(q4) + 0.07071*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.07071*np.sin(q1)*np.sin(q2)*np.cos(q4) - 0.0411*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0411*np.cos(q1)*np.cos(q3))**2)
        
        ksi2[4] = ((2*self.l2*np.sin(q1)*np.cos(q2) - 2*self.l3*np.sin(q1)*np.sin(q2)*np.cos(q3) + 0.0822*np.sin(q1)*np.sin(q2)*np.sin(q3) - 0.14142*np.sin(q1)*np.sin(q2)*np.sin(q4)*np.cos(q3) - 0.14142*np.sin(q1)*np.sin(q2)*np.cos(q3)*np.cos(q4) + 0.14142*np.sin(q1)*np.sin(q4)*np.cos(q2) - 0.14142*np.sin(q1)*np.cos(q2)*np.cos(q4))*(-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.sin(q4) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.cos(q4) + 0.07071*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.07071*np.sin(q1)*np.sin(q2)*np.cos(q4) - 0.0411*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0411*np.cos(q1)*np.cos(q3))/2 + (2*self.l2*np.cos(q1)*np.cos(q2) - 2*self.l3*np.sin(q2)*np.cos(q1)*np.cos(q3) + 0.0822*np.sin(q2)*np.sin(q3)*np.cos(q1) - 0.14142*np.sin(q2)*np.sin(q4)*np.cos(q1)*np.cos(q3) - 0.14142*np.sin(q2)*np.cos(q1)*np.cos(q3)*np.cos(q4) + 0.14142*np.sin(q4)*np.cos(q1)*np.cos(q2) - 0.14142*np.cos(q1)*np.cos(q2)*np.cos(q4))*(-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 0.0411*np.sin(q1)*np.cos(q3) + 0.07071*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.07071*np.sin(q2)*np.cos(q1)*np.cos(q4) - 0.0411*np.sin(q3)*np.cos(q1)*np.cos(q2))/2)/np.sqrt((-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 0.0411*np.sin(q1)*np.cos(q3) + 0.07071*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.07071*np.sin(q2)*np.cos(q1)*np.cos(q4) - 0.0411*np.sin(q3)*np.cos(q1)*np.cos(q2))**2 + (-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.sin(q4) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.cos(q4) + 0.07071*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.07071*np.sin(q1)*np.sin(q2)*np.cos(q4) - 0.0411*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0411*np.cos(q1)*np.cos(q3))**2)
        
        ksi3[4] = ((2*self.l3*(-np.sin(q1)*np.cos(q3) - np.sin(q3)*np.cos(q1)*np.cos(q2)) + 2*(-0.07071*np.sin(q1)*np.cos(q3) - 0.07071*np.sin(q3)*np.cos(q1)*np.cos(q2))*np.sin(q4) + 2*(-0.07071*np.sin(q1)*np.cos(q3) - 0.07071*np.sin(q3)*np.cos(q1)*np.cos(q2))*np.cos(q4) + 0.0822*np.sin(q1)*np.sin(q3) - 0.0822*np.cos(q1)*np.cos(q2)*np.cos(q3))*(-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 0.0411*np.sin(q1)*np.cos(q3) + 0.07071*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.07071*np.sin(q2)*np.cos(q1)*np.cos(q4) - 0.0411*np.sin(q3)*np.cos(q1)*np.cos(q2))/2 + (2*self.l3*(-np.sin(q1)*np.sin(q3)*np.cos(q2) + np.cos(q1)*np.cos(q3)) + 2*(-0.07071*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.07071*np.cos(q1)*np.cos(q3))*np.sin(q4) + 2*(-0.07071*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.07071*np.cos(q1)*np.cos(q3))*np.cos(q4) - 0.0822*np.sin(q1)*np.cos(q2)*np.cos(q3) - 0.0822*np.sin(q3)*np.cos(q1))*(-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.sin(q4) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.cos(q4) + 0.07071*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.07071*np.sin(q1)*np.sin(q2)*np.cos(q4) - 0.0411*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0411*np.cos(q1)*np.cos(q3))/2)/np.sqrt((-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 0.0411*np.sin(q1)*np.cos(q3) + 0.07071*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.07071*np.sin(q2)*np.cos(q1)*np.cos(q4) - 0.0411*np.sin(q3)*np.cos(q1)*np.cos(q2))**2 + (-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.sin(q4) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.cos(q4) + 0.07071*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.07071*np.sin(q1)*np.sin(q2)*np.cos(q4) - 0.0411*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0411*np.cos(q1)*np.cos(q3))**2)
        
        ksi4[4] = ((-2*(-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + 2*(-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) + 0.14142*np.sin(q2)*np.sin(q4)*np.cos(q1) + 0.14142*np.sin(q2)*np.cos(q1)*np.cos(q4))*(-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 0.0411*np.sin(q1)*np.cos(q3) + 0.07071*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.07071*np.sin(q2)*np.cos(q1)*np.cos(q4) - 0.0411*np.sin(q3)*np.cos(q1)*np.cos(q2))/2 + (-2*(0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.sin(q4) + 2*(0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.cos(q4) + 0.14142*np.sin(q1)*np.sin(q2)*np.sin(q4) + 0.14142*np.sin(q1)*np.sin(q2)*np.cos(q4))*(-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.sin(q4) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.cos(q4) + 0.07071*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.07071*np.sin(q1)*np.sin(q2)*np.cos(q4) - 0.0411*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0411*np.cos(q1)*np.cos(q3))/2)/np.sqrt((-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 0.0411*np.sin(q1)*np.cos(q3) + 0.07071*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.07071*np.sin(q2)*np.cos(q1)*np.cos(q4) - 0.0411*np.sin(q3)*np.cos(q1)*np.cos(q2))**2 + (-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.sin(q4) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.cos(q4) + 0.07071*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.07071*np.sin(q1)*np.sin(q2)*np.cos(q4) - 0.0411*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0411*np.cos(q1)*np.cos(q3))**2)
        
        ksi5[4] = 0
        ksi6[4] = 0
        ksi7[4] = 0
    
        #6o shmeio (L6)
    
        ksi1[5] = ((-2*self.l2*np.sin(q1)*np.sin(q2) + 2*self.l3*(-np.sin(q1)*np.cos(q2)*np.cos(q3) - np.sin(q3)*np.cos(q1)) + 2*(-0.120709041*np.sin(q1)*np.cos(q2)*np.cos(q3) - 0.120709041*np.sin(q3)*np.cos(q1))*np.sin(q4) + 2*(-0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) - 0.07071*np.sin(q3)*np.cos(q1))*np.cos(q4) - 0.14142*np.sin(q1)*np.sin(q2)*np.sin(q4) + 0.241418082*np.sin(q1)*np.sin(q2)*np.cos(q4) + 0.0822*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.0822*np.cos(q1)*np.cos(q3))*(-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.120709041*np.sin(q1)*np.sin(q3) + 0.120709041*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 0.0411*np.sin(q1)*np.cos(q3) + 0.07071*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.120709041*np.sin(q2)*np.cos(q1)*np.cos(q4) - 0.0411*np.sin(q3)*np.cos(q1)*np.cos(q2))/2 + (2*self.l2*np.sin(q2)*np.cos(q1) + 2*self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + 2*(-0.120709041*np.sin(q1)*np.sin(q3) + 0.120709041*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + 2*(-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 0.0822*np.sin(q1)*np.cos(q3) + 0.14142*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.241418082*np.sin(q2)*np.cos(q1)*np.cos(q4) - 0.0822*np.sin(q3)*np.cos(q1)*np.cos(q2))*(-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.120709041*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.120709041*np.sin(q3)*np.cos(q1))*np.sin(q4) + 0.07071*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.120709041*np.sin(q1)*np.sin(q2)*np.cos(q4) - 0.0411*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0411*np.cos(q1)*np.cos(q3))/2)/np.sqrt((-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.120709041*np.sin(q1)*np.sin(q3) + 0.120709041*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 0.0411*np.sin(q1)*np.cos(q3) + 0.07071*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.120709041*np.sin(q2)*np.cos(q1)*np.cos(q4) - 0.0411*np.sin(q3)*np.cos(q1)*np.cos(q2))**2 + (-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.120709041*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.120709041*np.sin(q3)*np.cos(q1))*np.sin(q4) + 0.07071*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.120709041*np.sin(q1)*np.sin(q2)*np.cos(q4) - 0.0411*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0411*np.cos(q1)*np.cos(q3))**2)
    
        ksi2[5] = ((2*self.l2*np.sin(q1)*np.cos(q2) - 2*self.l3*np.sin(q1)*np.sin(q2)*np.cos(q3) + 0.0822*np.sin(q1)*np.sin(q2)*np.sin(q3) - 0.241418082*np.sin(q1)*np.sin(q2)*np.sin(q4)*np.cos(q3) - 0.14142*np.sin(q1)*np.sin(q2)*np.cos(q3)*np.cos(q4) + 0.14142*np.sin(q1)*np.sin(q4)*np.cos(q2) - 0.241418082*np.sin(q1)*np.cos(q2)*np.cos(q4))*(-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.120709041*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.120709041*np.sin(q3)*np.cos(q1))*np.sin(q4) + 0.07071*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.120709041*np.sin(q1)*np.sin(q2)*np.cos(q4) - 0.0411*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0411*np.cos(q1)*np.cos(q3))/2 + (2*self.l2*np.cos(q1)*np.cos(q2) - 2*self.l3*np.sin(q2)*np.cos(q1)*np.cos(q3) + 0.0822*np.sin(q2)*np.sin(q3)*np.cos(q1) - 0.241418082*np.sin(q2)*np.sin(q4)*np.cos(q1)*np.cos(q3) - 0.14142*np.sin(q2)*np.cos(q1)*np.cos(q3)*np.cos(q4) + 0.14142*np.sin(q4)*np.cos(q1)*np.cos(q2) - 0.241418082*np.cos(q1)*np.cos(q2)*np.cos(q4))*(-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.120709041*np.sin(q1)*np.sin(q3) + 0.120709041*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 0.0411*np.sin(q1)*np.cos(q3) + 0.07071*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.120709041*np.sin(q2)*np.cos(q1)*np.cos(q4) - 0.0411*np.sin(q3)*np.cos(q1)*np.cos(q2))/2)/np.sqrt((-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.120709041*np.sin(q1)*np.sin(q3) + 0.120709041*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 0.0411*np.sin(q1)*np.cos(q3) + 0.07071*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.120709041*np.sin(q2)*np.cos(q1)*np.cos(q4) - 0.0411*np.sin(q3)*np.cos(q1)*np.cos(q2))**2 + (-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.120709041*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.120709041*np.sin(q3)*np.cos(q1))*np.sin(q4) + 0.07071*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.120709041*np.sin(q1)*np.sin(q2)*np.cos(q4) - 0.0411*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0411*np.cos(q1)*np.cos(q3))**2)
    
        ksi3[5] = ((2*self.l3*(-np.sin(q1)*np.cos(q3) - np.sin(q3)*np.cos(q1)*np.cos(q2)) + 2*(-0.120709041*np.sin(q1)*np.cos(q3) - 0.120709041*np.sin(q3)*np.cos(q1)*np.cos(q2))*np.sin(q4) + 2*(-0.07071*np.sin(q1)*np.cos(q3) - 0.07071*np.sin(q3)*np.cos(q1)*np.cos(q2))*np.cos(q4) + 0.0822*np.sin(q1)*np.sin(q3) - 0.0822*np.cos(q1)*np.cos(q2)*np.cos(q3))*(-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.120709041*np.sin(q1)*np.sin(q3) + 0.120709041*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 0.0411*np.sin(q1)*np.cos(q3) + 0.07071*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.120709041*np.sin(q2)*np.cos(q1)*np.cos(q4) - 0.0411*np.sin(q3)*np.cos(q1)*np.cos(q2))/2 + (2*self.l3*(-np.sin(q1)*np.sin(q3)*np.cos(q2) + np.cos(q1)*np.cos(q3)) + 2*(-0.120709041*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.120709041*np.cos(q1)*np.cos(q3))*np.sin(q4) + 2*(-0.07071*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.07071*np.cos(q1)*np.cos(q3))*np.cos(q4) - 0.0822*np.sin(q1)*np.cos(q2)*np.cos(q3) - 0.0822*np.sin(q3)*np.cos(q1))*(-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.120709041*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.120709041*np.sin(q3)*np.cos(q1))*np.sin(q4) + 0.07071*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.120709041*np.sin(q1)*np.sin(q2)*np.cos(q4) - 0.0411*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0411*np.cos(q1)*np.cos(q3))/2)/np.sqrt((-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.120709041*np.sin(q1)*np.sin(q3) + 0.120709041*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 0.0411*np.sin(q1)*np.cos(q3) + 0.07071*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.120709041*np.sin(q2)*np.cos(q1)*np.cos(q4) - 0.0411*np.sin(q3)*np.cos(q1)*np.cos(q2))**2 + (-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.120709041*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.120709041*np.sin(q3)*np.cos(q1))*np.sin(q4) + 0.07071*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.120709041*np.sin(q1)*np.sin(q2)*np.cos(q4) - 0.0411*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0411*np.cos(q1)*np.cos(q3))**2)
        
        ksi4[5] = ((2*(-0.120709041*np.sin(q1)*np.sin(q3) + 0.120709041*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 2*(-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + 0.241418082*np.sin(q2)*np.sin(q4)*np.cos(q1) + 0.14142*np.sin(q2)*np.cos(q1)*np.cos(q4))*(-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.120709041*np.sin(q1)*np.sin(q3) + 0.120709041*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 0.0411*np.sin(q1)*np.cos(q3) + 0.07071*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.120709041*np.sin(q2)*np.cos(q1)*np.cos(q4) - 0.0411*np.sin(q3)*np.cos(q1)*np.cos(q2))/2 + (-2*(0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.sin(q4) + 2*(0.120709041*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.120709041*np.sin(q3)*np.cos(q1))*np.cos(q4) + 0.241418082*np.sin(q1)*np.sin(q2)*np.sin(q4) + 0.14142*np.sin(q1)*np.sin(q2)*np.cos(q4))*(-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.120709041*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.120709041*np.sin(q3)*np.cos(q1))*np.sin(q4) + 0.07071*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.120709041*np.sin(q1)*np.sin(q2)*np.cos(q4) - 0.0411*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0411*np.cos(q1)*np.cos(q3))/2)/np.sqrt((-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.120709041*np.sin(q1)*np.sin(q3) + 0.120709041*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 0.0411*np.sin(q1)*np.cos(q3) + 0.07071*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.120709041*np.sin(q2)*np.cos(q1)*np.cos(q4) - 0.0411*np.sin(q3)*np.cos(q1)*np.cos(q2))**2 + (-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.120709041*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.120709041*np.sin(q3)*np.cos(q1))*np.sin(q4) + 0.07071*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.120709041*np.sin(q1)*np.sin(q2)*np.cos(q4) - 0.0411*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0411*np.cos(q1)*np.cos(q3))**2)
        
        ksi5[5] = 0
        ksi6[5] = 0
        ksi7[5] = 0
        
        #7o shmeio (L7)
        
        ksi1[6] = ((-2*self.l2*np.sin(q1)*np.sin(q2) + 2*self.l3*(-np.sin(q1)*np.cos(q2)*np.cos(q3) - np.sin(q3)*np.cos(q1)) + 2*(-0.170708082*np.sin(q1)*np.cos(q2)*np.cos(q3) - 0.170708082*np.sin(q3)*np.cos(q1))*np.sin(q4) + 2*(-0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) - 0.07071*np.sin(q3)*np.cos(q1))*np.cos(q4) - 0.14142*np.sin(q1)*np.sin(q2)*np.sin(q4) + 0.341416164*np.sin(q1)*np.sin(q2)*np.cos(q4) + 0.0822*np.sin(q1)*np.sin(q3)*np.cos(q2) - 0.0822*np.cos(q1)*np.cos(q3))*(-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.170708082*np.sin(q1)*np.sin(q3) + 0.170708082*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 0.0411*np.sin(q1)*np.cos(q3) + 0.07071*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.170708082*np.sin(q2)*np.cos(q1)*np.cos(q4) - 0.0411*np.sin(q3)*np.cos(q1)*np.cos(q2))/2 + (2*self.l2*np.sin(q2)*np.cos(q1) + 2*self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + 2*(-0.170708082*np.sin(q1)*np.sin(q3) + 0.170708082*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + 2*(-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 0.0822*np.sin(q1)*np.cos(q3) + 0.14142*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.341416164*np.sin(q2)*np.cos(q1)*np.cos(q4) - 0.0822*np.sin(q3)*np.cos(q1)*np.cos(q2))*(-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.170708082*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.170708082*np.sin(q3)*np.cos(q1))*np.sin(q4) + 0.07071*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.170708082*np.sin(q1)*np.sin(q2)*np.cos(q4) - 0.0411*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0411*np.cos(q1)*np.cos(q3))/2)/np.sqrt((-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.170708082*np.sin(q1)*np.sin(q3) + 0.170708082*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 0.0411*np.sin(q1)*np.cos(q3) + 0.07071*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.170708082*np.sin(q2)*np.cos(q1)*np.cos(q4) - 0.0411*np.sin(q3)*np.cos(q1)*np.cos(q2))**2 + (-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.170708082*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.170708082*np.sin(q3)*np.cos(q1))*np.sin(q4) + 0.07071*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.170708082*np.sin(q1)*np.sin(q2)*np.cos(q4) - 0.0411*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0411*np.cos(q1)*np.cos(q3))**2)
        
        ksi2[6] = ((2*self.l2*np.sin(q1)*np.cos(q2) - 2*self.l3*np.sin(q1)*np.sin(q2)*np.cos(q3) + 0.0822*np.sin(q1)*np.sin(q2)*np.sin(q3) - 0.341416164*np.sin(q1)*np.sin(q2)*np.sin(q4)*np.cos(q3) - 0.14142*np.sin(q1)*np.sin(q2)*np.cos(q3)*np.cos(q4) + 0.14142*np.sin(q1)*np.sin(q4)*np.cos(q2) - 0.341416164*np.sin(q1)*np.cos(q2)*np.cos(q4))*(-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.170708082*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.170708082*np.sin(q3)*np.cos(q1))*np.sin(q4) + 0.07071*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.170708082*np.sin(q1)*np.sin(q2)*np.cos(q4) - 0.0411*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0411*np.cos(q1)*np.cos(q3))/2 + (2*self.l2*np.cos(q1)*np.cos(q2) - 2*self.l3*np.sin(q2)*np.cos(q1)*np.cos(q3) + 0.0822*np.sin(q2)*np.sin(q3)*np.cos(q1) - 0.341416164*np.sin(q2)*np.sin(q4)*np.cos(q1)*np.cos(q3) - 0.14142*np.sin(q2)*np.cos(q1)*np.cos(q3)*np.cos(q4) + 0.14142*np.sin(q4)*np.cos(q1)*np.cos(q2) - 0.341416164*np.cos(q1)*np.cos(q2)*np.cos(q4))*(-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.170708082*np.sin(q1)*np.sin(q3) + 0.170708082*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 0.0411*np.sin(q1)*np.cos(q3) + 0.07071*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.170708082*np.sin(q2)*np.cos(q1)*np.cos(q4) - 0.0411*np.sin(q3)*np.cos(q1)*np.cos(q2))/2)/np.sqrt((-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.170708082*np.sin(q1)*np.sin(q3) + 0.170708082*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 0.0411*np.sin(q1)*np.cos(q3) + 0.07071*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.170708082*np.sin(q2)*np.cos(q1)*np.cos(q4) - 0.0411*np.sin(q3)*np.cos(q1)*np.cos(q2))**2 + (-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.170708082*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.170708082*np.sin(q3)*np.cos(q1))*np.sin(q4) + 0.07071*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.170708082*np.sin(q1)*np.sin(q2)*np.cos(q4) - 0.0411*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0411*np.cos(q1)*np.cos(q3))**2)
        
        ksi3[6] = ((2*self.l3*(-np.sin(q1)*np.cos(q3) - np.sin(q3)*np.cos(q1)*np.cos(q2)) + 2*(-0.170708082*np.sin(q1)*np.cos(q3) - 0.170708082*np.sin(q3)*np.cos(q1)*np.cos(q2))*np.sin(q4) + 2*(-0.07071*np.sin(q1)*np.cos(q3) - 0.07071*np.sin(q3)*np.cos(q1)*np.cos(q2))*np.cos(q4) + 0.0822*np.sin(q1)*np.sin(q3) - 0.0822*np.cos(q1)*np.cos(q2)*np.cos(q3))*(-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.170708082*np.sin(q1)*np.sin(q3) + 0.170708082*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 0.0411*np.sin(q1)*np.cos(q3) + 0.07071*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.170708082*np.sin(q2)*np.cos(q1)*np.cos(q4) - 0.0411*np.sin(q3)*np.cos(q1)*np.cos(q2))/2 + (2*self.l3*(-np.sin(q1)*np.sin(q3)*np.cos(q2) + np.cos(q1)*np.cos(q3)) + 2*(-0.170708082*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.170708082*np.cos(q1)*np.cos(q3))*np.sin(q4) + 2*(-0.07071*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.07071*np.cos(q1)*np.cos(q3))*np.cos(q4) - 0.0822*np.sin(q1)*np.cos(q2)*np.cos(q3) - 0.0822*np.sin(q3)*np.cos(q1))*(-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.170708082*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.170708082*np.sin(q3)*np.cos(q1))*np.sin(q4) + 0.07071*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.170708082*np.sin(q1)*np.sin(q2)*np.cos(q4) - 0.0411*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0411*np.cos(q1)*np.cos(q3))/2)/np.sqrt((-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.170708082*np.sin(q1)*np.sin(q3) + 0.170708082*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 0.0411*np.sin(q1)*np.cos(q3) + 0.07071*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.170708082*np.sin(q2)*np.cos(q1)*np.cos(q4) - 0.0411*np.sin(q3)*np.cos(q1)*np.cos(q2))**2 + (-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.170708082*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.170708082*np.sin(q3)*np.cos(q1))*np.sin(q4) + 0.07071*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.170708082*np.sin(q1)*np.sin(q2)*np.cos(q4) - 0.0411*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0411*np.cos(q1)*np.cos(q3))**2)
        
        ksi4[6] = ((2*(-0.170708082*np.sin(q1)*np.sin(q3) + 0.170708082*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 2*(-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + 0.341416164*np.sin(q2)*np.sin(q4)*np.cos(q1) + 0.14142*np.sin(q2)*np.cos(q1)*np.cos(q4))*(-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.170708082*np.sin(q1)*np.sin(q3) + 0.170708082*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 0.0411*np.sin(q1)*np.cos(q3) + 0.07071*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.170708082*np.sin(q2)*np.cos(q1)*np.cos(q4) - 0.0411*np.sin(q3)*np.cos(q1)*np.cos(q2))/2 + (-2*(0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.sin(q4) + 2*(0.170708082*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.170708082*np.sin(q3)*np.cos(q1))*np.cos(q4) + 0.341416164*np.sin(q1)*np.sin(q2)*np.sin(q4) + 0.14142*np.sin(q1)*np.sin(q2)*np.cos(q4))*(-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.170708082*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.170708082*np.sin(q3)*np.cos(q1))*np.sin(q4) + 0.07071*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.170708082*np.sin(q1)*np.sin(q2)*np.cos(q4) - 0.0411*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0411*np.cos(q1)*np.cos(q3))/2)/np.sqrt((-a2 + self.l2*np.sin(q2)*np.cos(q1) + self.l3*(-np.sin(q1)*np.sin(q3) + np.cos(q1)*np.cos(q2)*np.cos(q3)) + (-0.170708082*np.sin(q1)*np.sin(q3) + 0.170708082*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.sin(q4) + (-0.07071*np.sin(q1)*np.sin(q3) + 0.07071*np.cos(q1)*np.cos(q2)*np.cos(q3))*np.cos(q4) - 0.0411*np.sin(q1)*np.cos(q3) + 0.07071*np.sin(q2)*np.sin(q4)*np.cos(q1) - 0.170708082*np.sin(q2)*np.cos(q1)*np.cos(q4) - 0.0411*np.sin(q3)*np.cos(q1)*np.cos(q2))**2 + (-b2 + self.l2*np.sin(q1)*np.sin(q2) + self.l3*(np.sin(q1)*np.cos(q2)*np.cos(q3) + np.sin(q3)*np.cos(q1)) + (0.07071*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.07071*np.sin(q3)*np.cos(q1))*np.cos(q4) + (0.170708082*np.sin(q1)*np.cos(q2)*np.cos(q3) + 0.170708082*np.sin(q3)*np.cos(q1))*np.sin(q4) + 0.07071*np.sin(q1)*np.sin(q2)*np.sin(q4) - 0.170708082*np.sin(q1)*np.sin(q2)*np.cos(q4) - 0.0411*np.sin(q1)*np.sin(q3)*np.cos(q2) + 0.0411*np.cos(q1)*np.cos(q3))**2)
        
        ksi5[6] = 0
        ksi6[6] = 0
        ksi7[6] = 0
    

    #now we compute the sum of ksis of every point and we return a 7x1 matrix

        ksi_1 = 0
        ksi_2 = 0
        ksi_3 = 0
        ksi_4 = 0
        ksi_5 = 0
        ksi_6 = 0
        ksi_7 = 0
    
        for i in range(0,7):
            ksi_1 = ksi_1 + ksi1[i]
            ksi_2 = ksi_2 + ksi2[i]    #where ksij[i] => j shows the qj over which we
            ksi_3 = ksi_3 + ksi3[i]    #take the derivate and i shows the critical
            ksi_4 = ksi_4 + ksi4[i]    #point number
            ksi_5 = ksi_5 + ksi5[i]
            ksi_6 = ksi_6 + ksi6[i]
            ksi_7 = ksi_7 + ksi7[i]

        ksis = np.matrix([[ksi_1, ksi_2, ksi_3, ksi_4, ksi_5, ksi_6, ksi_7]])
        ksis = -ksis.T
        return ksis
    

    #here we compute the transformation matrices from joints' angular positions

    def tf_A01(self, r_joints_array):
        q1 = r_joints_array[0]
        tf = np.matrix([[np.cos(q1), -np.sin(q1), 0, 0],
                        [np.sin(q1), np.cos(q1), 0, 0],
                        [0, 0, 1, self.l1],
                        [0, 0, 0, 1]])
        return tf

    def tf_A02(self, r_joints_array):
        q2 = r_joints_array[1]
        tf_A12 = np.matrix([[np.cos(q2), -np.sin(q2), 0, 0],
                            [0, 0, 1, 0],
                            [-np.sin(q2), -np.cos(q2), 0, 0],
                            [0, 0, 0, 1]])
        tf = np.dot(self.tf_A01(r_joints_array), tf_A12)
        return tf

    def tf_A03(self, r_joints_array):
        q3 = r_joints_array[2]
        tf_A23 = np.matrix([[np.cos(q3), -np.sin(q3), 0, 0],
                            [0, 0, -1, -self.l2],
                            [np.sin(q3), np.cos(q3), 0, 0],
                            [0, 0, 0, 1]])
        tf = np.dot(self.tf_A02(r_joints_array), tf_A23)
        return tf

    def tf_A04(self, r_joints_array):
        q4 = r_joints_array[3]
        tf_A34 = np.matrix([[np.cos(q4), -np.sin(q4), 0, self.l3],
                            [0, 0, -1, 0],
                            [np.sin(q4), np.cos(q4), 0, 0],
                            [0, 0, 0, 1]])
        tf = np.dot(self.tf_A03(r_joints_array), tf_A34)
        return tf

    def tf_A05(self, r_joints_array):
        q5 = r_joints_array[4]
        tf_A45 = np.matrix([[np.cos(q5), -np.sin(q5), 0, self.l4*np.sin(self.theta1)],
                            [0, 0, -1, -self.l4*np.cos(self.theta1)],
                            [np.sin(q5), np.cos(q5), 0, 0],
                            [0, 0, 0, 1]])
        tf = np.dot(self.tf_A04(r_joints_array), tf_A45)
        return tf

    def tf_A06(self, r_joints_array):
        q6 = r_joints_array[5]
        tf_A56 = np.matrix([[np.cos(q6), -np.sin(q6), 0, 0],
                            [0, 0, -1, 0],
                            [np.sin(q6), np.cos(q6), 0, 0],
                            [0, 0, 0, 1]])
        tf = np.dot(self.tf_A05(r_joints_array), tf_A56)
        return tf

    def tf_A07(self, r_joints_array):
        q7 = r_joints_array[6]
        tf_A67 = np.matrix([[np.cos(q7), -np.sin(q7), 0, self.l5*np.sin(self.theta2)],
                            [0, 0, 1, self.l5*np.cos(self.theta2)],
                            [-np.sin(q7), -np.cos(q7), 0, 0],
                            [0, 0, 0, 1]])
        tf = np.dot(self.tf_A06(r_joints_array), tf_A67)
        return tf

#here we compute the transformation matrices for every critical point, but it is only for check and debugging, as we have computed the derivatives of the objective function mentioned above, in the external script "robo.ipynb" that is attached to the submission
#the whole process of constructing these arrays is analytically explained in the report

    def tf_L1(self, r_joints_array):
        tra1 = np.matrix([[1, 0, 0, 0],
                          [0, 1, 0, 0],
                          [0, 0, 1, 0.1062],
                          [0, 0, 0, 1]])

        rot1 = np.matrix([[0.70710, 0.70710, 0, 0],
                          [-0.70710, 0.70710, 0, 0],
                          [0, 0, 1, 0],
                          [0, 0, 0, 1]])

        tra1_2 = np.matrix([[1, 0, 0, 0],
                          [0, 1, 0, -0.063],
                          [0, 0, 1, 0],
                          [0, 0, 0, 1]])

        L1 = np.dot(self.tf_A04(r_joints_array), tra1)
        L1 = np.dot(L1, rot1)
        L1 = np.dot(L1, tra1_2)
        return L1

    def tf_L2(self, r_joints_array):
        tra2 = np.matrix([[1, 0, 0, 0.05],
                          [0, 1, 0, 0],
                          [0, 0, 1, 0],
                          [0, 0, 0, 1]])
        L2 = np.dot(self.tf_L1(r_joints_array), tra2)
        return L2

    def tf_L3(self, r_joints_array):
        tra3 = np.matrix([[1, 0, 0, 0.05],
                          [0, 1, 0, 0],
                          [0, 0, 1, 0],
                          [0, 0, 0, 1]])
        L3 = np.dot(self.tf_L2(r_joints_array), tra3)
        return L3

    def tf_L4(self, r_joints_array):
        tra4 = np.matrix([[1, 0, 0, 0],
                          [0, 1, 0, 0],
                          [0, 0, 1, -0.0676],
                          [0, 0, 0, 1]])
        L4 = np.dot(self.tf_A04(r_joints_array), tra4)
        return L4

    def tf_L5(self, r_joints_array):
        tra5 = np.matrix([[1, 0, 0, 0],
                          [0, 1, 0, 0],
                          [0, 0, 1, -0.1473], #-0.1062 - 0.0411
                          [0, 0, 0, 1]])
        L5 = np.dot(self.tf_L3(r_joints_array), tra5)
        return L5

    def tf_L6(self, r_joints_array):
        rot6 = np.matrix([[0.70710, 0.70710, 0, 0],
                          [-0.70710, 0.70710, 0, 0],
                          [0, 0, 1, 0],
                          [0, 0, 0, 1]])

        tra6 = np.matrix([[1, 0, 0, 0.05],
                          [0, 1, 0, 0],
                          [0, 0, 1, 0],
                          [0, 0, 0, 1]])

        L6 = np.dot(self.tf_L5(r_joints_array), rot6)
        L6 = np.dot(L6, tra6)
        return L6

    def tf_L7(self, r_joints_array):
        tra7 = np.matrix([[1, 0, 0, 0.05],
                          [0, 1, 0, 0],
                          [0, 0, 1, 0],
                          [0, 0, 0, 1]])
        L7 = np.dot(self.tf_L6(r_joints_array), tra7)
        return L7
